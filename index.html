<!DOCTYPE html>
<html lang="en">
<head>
<!-- This is for encryption secturity don't remove itU2hhc2hhbmsgR293ZGEgbmIgJiAoQ0tQKSBtYQ== -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#007bff">
<!-- U2hhc2hhbmsgR293ZGEgbmIgJiAoQ0tQKSBtYQ== -->

  

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>NTTF Parent Portal</title>
 <!-- Project by cp08 Shashank Gowda NB | Class Head Chrissi K (CKP) -->
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --primary:#007bff;
      --accent:#00bfff;
      --bg1:#f0f7ff;
      --bg2:#ffffff;
      --scroll-thumb:#007bff;
      --scroll-track:#cde4ff;
      --scroll-indicator:#00bfff;
    }

    html,body{
      height:100%;
      margin:0;
    }

/* U2hhc2hhbmsgR293ZGEgbmIgJiAoQ0tQKSBtYQ== */

    @keyframes gradientMove {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}


    body{
  font-family:'Poppins',sans-serif;
}
.login-bg {
  background: url("https://www.nccedu.com/wp-content/uploads/2021/03/nttf.png") no-repeat center center/cover,
              linear-gradient(135deg, #007bff99, #00bfff99);
  background-size: cover;
  animation: gradientMove 10s ease infinite;

      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      overflow:hidden;
      padding:20px;
      box-sizing:border-box;
    }

    .app-box{
      width:100%;
      max-width:430px;
      height:90vh;
      background:#fff;
      border-radius:20px;
      box-shadow:0 12px 40px rgba(0,0,0,0.12);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    /* header */
    .app-header{
      background:linear-gradient(90deg,var(--primary),var(--accent));
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 16px;
    }
    .app-header img{ height:32px; margin-right:8px; }
    .header-left{ display:flex; align-items:center; gap:6px; font-weight:600; }
    .header-title{ font-size:1rem; line-height:1.2; }
    .logout-btn{
      background:#fff; color:var(--primary); border:none; border-radius:20px;
      font-size:0.85rem; padding:6px 12px; font-weight:600; transition:0.25s;
    }
    .logout-btn:hover{ background:#e9f2ff; }

    /* login */
    #loginSection{
      flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;
      padding:30px; text-align:center;
    }
    #loginPhone { text-align:center; letter-spacing:1px; }

    .btn-spinner{
      width:16px; height:16px; border:2px solid rgba(255,255,255,0.6);
      border-top-color:#fff; border-radius:50%; display:inline-block; margin-right:6px;
      animation:spin .8s linear infinite;
    }
    @keyframes spin{ to { transform:rotate(360deg); } }

    /* messages area */
    .messages-section{
      flex:1; display:none; flex-direction:column; background:#f7fbff; position:relative;
      height:100%; overflow:hidden;
    }
    .welcome-box{
      background:#e9f5ff; text-align:center; font-weight:600; padding:10px; border-bottom:1px solid #cde5ff;
      font-size:0.95rem;
    }

    /* message list - scrollable */
    .message-list{
      flex:1;
      overflow-y:auto;
      overflow-x:hidden;
      padding:12px;
      scroll-behavior:smooth;
      transition:all .25s ease;
      scrollbar-width:thin;
      scrollbar-color:var(--scroll-thumb) var(--scroll-track);
      height:calc(100% - 60px);
      -webkit-overflow-scrolling:touch;
    }

    .message-list::-webkit-scrollbar{ width:8px; }
    .message-list::-webkit-scrollbar-thumb{
      background:linear-gradient(var(--scroll-thumb),var(--scroll-indicator));
      border-radius:10px;
      transition:background-color .2s;
    }
    .message-list::-webkit-scrollbar-thumb:hover{
      background:linear-gradient(var(--scroll-indicator),var(--scroll-thumb));
    }
    .message-list::-webkit-scrollbar-track{ background:var(--scroll-track); border-radius:10px; }

    /* floating scroll indicator */
    .scroll-indicator{
      position:absolute;
      right:14px;
      bottom:18px;
      background:var(--scroll-indicator);
      color:white;
      padding:6px 12px;
      border-radius:20px;
      font-size:0.8rem;
      box-shadow:0 6px 18px rgba(0,0,0,0.16);
      opacity:0;
      pointer-events:none;
      transition:opacity .25s ease, transform .25s ease;
      transform:translateY(6px);
      z-index:30;
    }
    .scroll-indicator.show{ opacity:1; transform:translateY(0); }

    /* message cards base */
    .message-card{
      background:#fff;
      border-radius:12px;
      padding:12px 14px;
      box-shadow:0 6px 18px rgba(12,30,60,0.06);
      margin-bottom:12px;
      word-wrap:break-word;
      will-change:transform,opacity;
      opacity:0;
      transform:translateY(20px);
      transition:all .6s cubic-bezier(.2,.9,.3,1);
    }
    .message-title{ font-weight:600; color:var(--primary); margin-bottom:6px; }
    .message-body{ font-size:.95rem; color:#222; line-height:1.3; }
    .message-meta{ font-size:.78rem; color:#666; margin-top:8px; }

    /* read/unread states */
    .message-card.unread {
      background:#fffbea;
      border-left:4px solid #ffc107;
    }
    .message-card.read {
      background:#fff;
      border-left:4px solid transparent;
    }

    /* glow for new messages */
    .message-card.new-message {
      animation: newMsgGlow 1.5s ease-out;
    }
    @keyframes newMsgGlow {
      0% { box-shadow:0 0 0px rgba(0,123,255,0); }
      40% { box-shadow:0 0 20px rgba(0,123,255,0.3); }
      100% { box-shadow:0 0 0px rgba(0,123,255,0); }
    }

    /* animations */
    .slide-left{ transform:translateX(-60px); }
    .slide-right{ transform:translateX(60px); }
    .slide-up{ transform:translateY(60px); }
    .message-card.show{ opacity:1; transform:translateX(0) translateY(0); }

    /* toast */
    .toast-container{
      position:fixed; top:20px; left:50%; transform:translateX(-50%); z-index:6000; width:min(92%,420px);
    }
    .toast-card{
      background:linear-gradient(90deg,#0d6efd,#00bfff); color:#fff; border-radius:10px; padding:12px 16px;
      margin:8px 0; box-shadow:0 10px 25px rgba(0,0,0,0.12); display:flex; align-items:center; justify-content:space-between;
    }

    @media (max-width:420px){
      .app-box{ height:94vh; border-radius:14px; }
    }
/*  <!-- Project by cp08 Shashank Gowda NB | Class Head Chrissi K (CKP) --> */
    @keyframes fadeOutBg {
  from { opacity: 1; }
  to   { opacity: 0; }
}

body.fade-out-bg {
  animation: fadeOutBg 1s ease forwards;
}


.partner-logo {
  width: 60px;
  height: auto;
  opacity: 0.8;
  transition: transform 0.3s ease, opacity 0.3s ease;
}
.partner-logo:hover {
  transform: scale(1.1);
  opacity: 1;
}

/* Subtle entrance animations */
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes fadeIn {
  from { opacity: 0; }
  to   { opacity: 1; }
}

  </style>
</head>

<body class="login-bg">

  <div class="app-box" id="appBox">
    <div class="app-header">
      <div class="header-left">
        <img src="logo.png" alt="Logo" onerror="this.style.display='none'"/>
        <div class="header-title">Entity of Parent Portal<br><small style="font-size:.8rem">NTTF Parent Portal</small></div>
      </div>
      <button class="logout-btn" id="logoutBtn" onclick="logout()" style="display:none">Logout</button>
    </div>

    <div id="loginSection">

  <!-- NTTF Logo -->
  <img src="./bgrmd_logo.png" alt="NTTF Logo" 
       class="mb-3" style="width:90px; height:auto; animation: fadeIn 1.2s ease;">

  <!-- Animated Typing Text -->
  <h5 class="text-primary fw-bold mb-3" style="animation: fadeInUp 1.5s ease;">
    <span id="typingText"></span>
  </h5>

  <!-- Phone Input -->
  <input type="tel" id="loginPhone" class="form-control mb-3" 
         placeholder="Enter 10-digit number" style="animation: fadeInUp 1.8s ease;">

  <!-- Login Button -->
  <button class="btn btn-primary w-100 mb-3" id="loginBtn" 
          onclick="login()" style="animation: fadeInUp 2s ease;">Login</button>

  <!-- Contact Info -->
  <p class="text-muted" style="font-size:.85rem; animation: fadeInUp 2.3s ease;">
    Don‚Äôt have an account? <b>Contact admin</b> to register.
  </p>

  <!-- Trusted Partners Section -->
  <div class="trusted-partners mt-4" style="animation: fadeInUp 2.5s ease;">
    <p class="text-secondary fw-semibold mb-2" style="font-size:.9rem;">Trusted Partners</p>
    <div class="d-flex justify-content-center align-items-center flex-wrap gap-3">
      <img src="https://th.bing.com/th/id/OIP.0yw37bhVdk9YcUAuU9c7tAHaE8?w=161&h=108&c=7&bgcl=b5c5ee&r=0&o=6&pid=13.1" alt="Tata" class="partner-logo">
      <img src="https://th.bing.com/th/id/OIP.p2rJ5FCz6SjTf1v1riX7awHaHP?w=108&h=108&c=1&bgcl=1e0d58&r=0&o=7&pid=ImgRC&rm=3" alt="Bosch" class="partner-logo">
      <img src="https://th.bing.com/th/id/OIP.tqbM7CUqfa_AzNFT72bDLAHaFQ?w=108&h=108&c=1&bgcl=61f0e0&r=0&o=7&pid=ImgRC&rm=3" alt="Toyota" class="partner-logo">
      <img src="https://www.bing.com/th/id/OIP.SuiVoBxZA56FkRzRZE5nugHaD7?w=290&h=211&c=8&rs=1&qlt=90&o=6&pid=3.1&rm=2" alt="ABB" class="partner-logo">
    </div>
  </div>

</div>


    <div class="messages-section" id="messagesSection">
      <div class="welcome-box" id="welcomeBox"></div>
      <div class="message-list" id="messagesList">
        <div class="text-center text-muted mt-3" id="noMessages">No messages yet.</div>
      </div>
      <div class="scroll-indicator" id="scrollIndicator">Scrolling‚Ä¶</div>
    </div>
  </div>

  <div class="toast-container" id="toastContainer"></div>

  <!-- Firebase + App logic -->
  <script type="module">

    const typingText = document.getElementById("typingText");
const messages = ["Welcome to NTTF Parent Portal...", "Connecting Parents & Institute..."];
let msgIndex = 0, charIndex = 0;
function typeEffect(){
  if(charIndex < messages[msgIndex].length){
    typingText.textContent += messages[msgIndex].charAt(charIndex);
    charIndex++;
    setTimeout(typeEffect, 100);
  } else {
    setTimeout(() => {
      typingText.textContent = "";
      msgIndex = (msgIndex + 1) % messages.length;
      charIndex = 0;
      typeEffect();
    }, 1500);
  }
}
typeEffect();

    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, getDoc, collection, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-messaging.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBLd5AduriTjMVeX4tAL0J-Hh4pWJ84s2k",
      authDomain: "collage-project-f641d.firebaseapp.com",
      projectId: "collage-project-f641d",
     storageBucket: "collage-project-f641d.firebasestorage.app",
      messagingSenderId: "716092619839",
      appId: "1:716092619839:web:7bf0cb23898c367ea0cc8a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const messaging = getMessaging(app);

    const loginPhone = document.getElementById("loginPhone");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const loginSection = document.getElementById("loginSection");
    const messagesSection = document.getElementById("messagesSection");
    const messagesList = document.getElementById("messagesList");
    const welcomeBox = document.getElementById("welcomeBox");
    const toastContainer = document.getElementById("toastContainer");
    const scrollIndicator = document.getElementById("scrollIndicator");

    loginPhone.addEventListener("input", () => {
      let v = loginPhone.value.replace(/\D/g, "");
      if (v.startsWith("91")) v = v.slice(2);
      v = v.slice(0, 10);
      loginPhone.value = v ? "+91" + v : "";
    });

    function playDing(){
      try{
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = "sine";
        osc.frequency.value = 880;
        gain.gain.setValueAtTime(0.001, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.08, ctx.currentTime + 0.01);
        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.4);
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start(ctx.currentTime);
        osc.stop(ctx.currentTime + 0.45);
      }catch(e){}
    }

    function showToast(title, msg){
      playDing();
      const t = document.createElement("div");
      t.className = "toast-card";
      t.innerHTML = `<div><strong>${title}</strong><div style="font-size:.95rem;opacity:.95;margin-top:4px;">${msg}</div></div>`;
      toastContainer.appendChild(t);
      setTimeout(()=> t.remove(), 4500);
    }

    function setLoading(btn, text){
      btn.disabled = true;
      btn.innerHTML = `<span class="btn-spinner"></span>${text}`;
    }
    function clearLoading(btn, text){
      btn.disabled = false;
      btn.innerHTML = text;
    }
// U2hhc2hhbmsgR293ZGEgbmIgJiAoQ0tQKSBtYQ==
    async function login(){
      
      const phone = loginPhone.value.trim();
      if (!phone || phone.length !== 13) {
        alert("Enter valid 10-digit number (will be prefixed with +91)");
        return;
      }
      setLoading(loginBtn, "Logging in...");
      try{
        const snap = await getDoc(doc(db, "users", phone));
        if (snap.exists()){
          const data = snap.data();
          localStorage.setItem("userPhone", phone);
          localStorage.setItem("userName", data.name || "Parent");
          showToast("Login Successful", `Welcome ${data.name || "Parent"}!`);
          showMessages(phone, data.name || "Parent");
        } else {
          clearLoading(loginBtn, "Login");
          alert("No user found.");
        }
      }catch(err){
        console.error(err);
        clearLoading(loginBtn, "Login");
        alert("Login failed. Check console.");
      }
    }
    window.login = login;

  async function logout() {
  setLoading(logoutBtn, "Logging out...");
  localStorage.clear();
  showToast("Logged out", "See you soon!");

  // ‚úÖ Instantly show login UI (prevents white screen)
  document.body.className = "login-bg";
  loginSection.style.display = "flex";
  messagesSection.style.display = "none";
  logoutBtn.style.display = "none";

  // ‚úÖ Safe redirect for Hopweb / WebView apps
  setTimeout(() => {
    try {
      window.location.href = "index.html";  // üëà your actual login page
    } catch (e) {
      window.location.replace("index.html"); // fallback if WebView blocks reload
    }
  }, 700);
}

// U2hhc2hhbmsgR293ZGEgbmIgJiAoQ0tQKSBtYQ==

    window.logout = logout;

    async function enableNotifications(phone){
      try{
        const perm = await Notification.requestPermission();
        if (perm === "granted"){
          const token = await getToken(messaging, {
            vapidKey: "BLm3tAuNaXg_3OS_dJGs5-0qiNCGhYNbcUk1WJOOeOnCtCZ1MdgZ1TWU4veor2yWbYZMSRo8JbkXxvZ8dkXSqm4"
          });
          await setDoc(doc(db, "userTokens", phone), { token, updatedAt: new Date().toISOString() });
        }
      }catch(e){ console.log("Notif:", e); }
    }

    // read/unread tracker
    function markAsRead(id) {
      const readIds = JSON.parse(localStorage.getItem("readMessages") || "[]");
      if (!readIds.includes(id)) {
        readIds.push(id);
        localStorage.setItem("readMessages", JSON.stringify(readIds));
      }
    }
    function isRead(id) {
      const readIds = JSON.parse(localStorage.getItem("readMessages") || "[]");
      return readIds.includes(id);
    }

    // IntersectionObserver
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const card = entry.target;
          card.classList.add("show");
          if (card.classList.contains("unread")) {
            card.classList.remove("unread");
            card.classList.add("read");
            markAsRead(card.dataset.id);
          }
          observer.unobserve(card);
        }
      });
    }, { threshold: 0.22 });

    function observeCards(){
      const cards = document.querySelectorAll(".message-card");
      cards.forEach(c => {
        if (!c.classList.contains("show")) observer.observe(c);
      });
    }

    function listenMessages(){
      return onSnapshot(collection(db, "messages"), (snapshot) => {
        const previousIds = Array.from(
          messagesList.querySelectorAll(".message-card")
        ).map((el) => el.dataset.id);

        messagesList.innerHTML = "";
        if (snapshot.empty) {
          messagesList.innerHTML = "<div class='text-center text-muted mt-3'>No messages yet.</div>";
          return;
        }

        const docs = snapshot.docs.map((d) => ({ id: d.id, ...d.data() }));
        docs.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));

        docs.forEach((msg, index) => {
          const animClass = index % 3 === 0 ? "slide-left" : index % 3 === 1 ? "slide-right" : "slide-up";
          const card = document.createElement("div");
          const read = isRead(msg.id);
          const isNew = !previousIds.includes(msg.id);
          card.className = `message-card ${animClass} ${read ? "read" : "unread"} ${isNew ? "new-message" : ""}`;
          card.dataset.id = msg.id;
          card.innerHTML = `
            <div class="message-title">${escapeHtml(msg.title || "Message")}</div>
            <div class="message-body">${escapeHtml(msg.body || "")}</div>
            <div class="message-meta">üë§ ${escapeHtml(msg.sender || "Admin")} ¬∑ ${new Date(msg.timestamp || Date.now()).toLocaleString()}</div>
          `;
          messagesList.appendChild(card);
          observer.observe(card);
        });

        observeCards();
        messagesList.scrollTo({ top: messagesList.scrollHeight, behavior: "smooth" });
      });
    }

    function escapeHtml(s){
      return String(s)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#039;')
        .replace(/\n/g,'<br>');
    }

    let scrollTimeout;
    messagesList.addEventListener("scroll", () => {
      scrollIndicator.classList.add("show");
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        scrollIndicator.classList.remove("show");
      }, 700);
    });

    onMessage(messaging, async (payload) => {
  console.log("üì© Foreground message received:", payload);
  const { title, body } = payload.notification || {};
  
  // Request permission just in case
  if (Notification.permission !== "granted") {
    await Notification.requestPermission();
  }

  // Show a visible toast and system notification
  showToast(title || "New Message", body || "");
  new Notification(title || "New Message", { body: body || "You have a new update", icon: "logo.png" });
});


    async function showMessages(phone, name){
      document.body.classList.add("fade-out-bg");
setTimeout(() => document.body.classList.remove("login-bg", "fade-out-bg"), 1000);

// U2hhc2hhbmsgR293ZGEgbmIgJiAoQ0tQKSBtYQ==
      loginSection.style.display = "none";
      messagesSection.style.display = "flex";
      logoutBtn.style.display = "inline-block";
      welcomeBox.innerHTML = `üëã Welcome, <b>${escapeHtml(name)}</b><br><small>${escapeHtml(phone)}</small>`;
      listenMessages();
      enableNotifications(phone);
    }

    const storedPhone = localStorage.getItem("userPhone");
    const storedName = localStorage.getItem("userName");
    if (storedPhone) {
      showMessages(storedPhone, storedName);
    }
  </script>

<!-- U2hhc2hhbmsgR293ZGEgbmIgJiAoQ0tQKSBtYQ== -->

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("firebase-messaging-sw.js")
    .then(reg => console.log("‚úÖ Service Worker registered:", reg))
    .catch(err => console.error("‚ùå SW registration failed:", err));
}
</script>
 <!-- Project by cp08 Shashank Gowda NB | Class Head Chrissi K (CKP) -->

 

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
